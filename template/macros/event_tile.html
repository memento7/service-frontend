{% macro emotion_bubbles(emotions, max=4, max_size=13) -%}
	{% for emotion in emotions %}
		{% if loop.index <= max %}
		<span class="emotion">
			<i style="width: {{ emotion.weight * max_size }}px; height: {{ emotion.weight * max_size }}px; background-color: {{ rand_color() }}"></i>
			<span>{{ emotion.title }}</span>
		</span>
		{% endif %}
	{% endfor %}
{% endmacro %}

{% macro issue_label(issue_data) -%}
	<span class="issue-label {{ issue_data.rank() }}-rank">
		<i class="hidden2">{{ issue_data.rank() | upper }}</i>
		<span class="hidden2">{{ issue_data.label() }}</span>
	</span>
{% endmacro %}


{% macro category_label(event_type, class_append='') -%}
	<span class="category-label category-{{ event_category_id(event_type) }} {{ class_append }}">
		<span class="hidden2">{{ event_type }}</span>
	</span>
{% endmacro %}


{% macro event_tile(event, show_date=False) -%}
	<div class="event-tile clearfix">
		<div class="fl">
			<h4>
				<a href="/event/{{ event.id }}">{{ event.title }}</a>
			</h4>

			{% if show_date %}
			<div class="date">
				{{ event.date.split("-")[0:2] | join('.') }}
			</div>
			{% endif %}
			
			<div class="labels emotion-bubbles">
				{{ issue_label(event.issue_data) }}
				{{ category_label(event.type) }}
				{{ emotion_bubbles(event.emotions, 2) }}
			</div>

		</div>
		<div class="fr">
			{% if first_image(event.images) %}
			<img src="{{ first_image(event.images) }}">
			{% endif %}
		</div>
	</div>
{% endmacro %}


{% macro mini_event_tile(event) -%}
	<div class="event-tile mini-event-tile">
		<a href="/event/{{ event.id }}">
			<div><img src="{{ first_image(event.images) }}" width="100%"></div>
			<h4>{{ event.title }}</h4>
		</a>
		<div class="labels">
			{{ issue_label(event.issue_data) }}
			{{ category_label(event.type) }}
		</div>
		<div class="emotion-bubbles">
			{{ emotion_bubbles(event.emotions, 2) }}
		</div>
	</div>
{% endmacro %}


{% macro gallery_event_tile(event) -%}
	<a href="/event/{{ event.id }}">
		<div class="event-tile gallery-event-tile">
			<div class="background" style="{{ first_image(event.images, True) }}"></div>
			
			<div class="labels">
				{{ issue_label(event.issue_data) }}
				{{ category_label(event.type, 'black') }}
			</div>

			<h4>{{ event.title }}</h4>
			<div class="emotion-bubbles">
				{{ emotion_bubbles(event.emotions, 2) }}
			</div>
		</div>
	</a>
{% endmacro %}

