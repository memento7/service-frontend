{% extends "/layouts/people_magazine.html" %}
{% import "/macros/event_tile.html" as event_tile %}

{% block head %}
	{{ super() }}

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	<script type="text/javascript" src="/js/people.js"></script>
{% endblock %}

		
{% block content %}
	{{ super() }}

	{% for w in person.in_one_word %}
	<section id="in-one-word" class="common-tile">
		<div>
			<i class="fa fa-quote-left"></i>
			<h2 style="font-size: {{ iow_size(w.keyword) }}">{{ w.keyword }}</h2>
			<i class="fa fa-quote-right"></i>
		</div>
		{% if w.reference %}
		<div class="reference">
			- {{ w.reference }}
		</div>
		{% endif %}
	</section>
	{% endfor %}


	{% if person.group %}
	<section id="singer-group" class="common-tile">
		<div class="title clearfix">
			<h4 class="group-title fl">{{ person.group.name }}</h4>
			<div class="group-company fr">{{ person.group.belongs }}</div>
		</div>
		<ul class="member clearfix">
			{% for member in person.group.members %}
			<li>
				<img src="{{ member.image }}" width="60" height="60">
				<div>{{ member.name }}</div>
			</li>
			{% endfor %}
		</ul>
	</section>
	{% endif %}


	<section id="people-trend" class="common-tile">
		<h3>왜 떴을까?</h3>
		<div class="graph-area">
			{% set merge_cnt = 5 %}
			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="105" viewBox="0 0 {{ trend_graph | length * merge_cnt }} 105" preserveAspectRatio="none">
				<path d="M 0, 90
					{% for d in trend_graph %} L {{ merge_cnt * loop.index }}, {{ 90 - d.value }} {% endfor %}
					L {{ trend_graph | length * merge_cnt }}, 90
				" />
			</svg>
			<div class="overlay">
			{% for tt in top_trends.values() %}
				{% set x_pos = tt.graph_data.index / (trend_graph | length) * 100 %}
				<span class="number" style="
					left: {{ x_pos }}%;
					top: {{ 95 - tt.graph_data.value }}px;
					color: {{ tt.color }};
				">{{ circular_number(loop.index) }}</span>

				<span class="date" style="
					left: {{ x_pos }}%;
				">{{ tt.event.date.split('-')[0:2] | join('.') }}</span>
			{% endfor %}
			</div>
		</div>
		<div class="events">
		{% for tt in top_trends.values() %}
			<span class="number" style="color: {{ tt.color }}">
				{{ circular_number(loop.index) }}
			</span>

			{{ event_tile.event_tile(tt.event, show_date=True) }}
		{% endfor %}
		</div>
	</section>


	{% if person.roles and person.stat_counts %}
	<section id="people-stats" class="common-tile">
		<h3>재미로 보는 능력치</h3>
		<div class="content clearfix total-{{ person.stat_counts }}stats">
			{% for roleid, roledata in person.roles.items() %}
			{% if roledata.stats2 %}

			<div class="stat fl">
				<div class="clearfix">
					<span class="label fl">{{ roledata.name }}</span>
					<span class="fr">
						<a href="./{{ roledata.name }}">자세히</a>
					</span>
				</div>
				<div>
					<canvas id="stat-chart-{{ loop.index }}" width="165" height="125"></canvas>
				</div>
			</div>

			<script type="text/javascript">
				makeStatChart(
					document.getElementById("stat-chart-{{ loop.index }}"),
					{{ roledata.stats2.labels | safe }},
					{{ roledata.stats2.datas | safe }}
				);
			</script>
			{% endif %}
			{% endfor %}
		</div>

	</section>
	{% endif %}
		
{% endblock %}